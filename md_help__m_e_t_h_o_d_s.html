<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Opticka: Behavioural Task Methods and Parameters [work-in-progress]</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="opticka.png"/></td>
  <td id="projectalign">
   <div id="projectname">Opticka<span id="projectnumber">&#160;2.06</span>
   </div>
   <div id="projectbrief">Opticka is an experiment manager for behavioral research.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_help__m_e_t_h_o_d_s.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Behavioural Task Methods and Parameters [work-in-progress] </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >The state machine defines a set of states and the connections between them. The state machine can run cell arrays of methods (anoymous functions) as states are entered, within and exited. In addition there are ways to transition out of a state if some condition is met. These method calls control the logic and flow of experiments. <br  />
</p>
<div class="fragment"><div class="line">╔════════════════════════════════════════════════════════════════════════════════════════════════╗</div>
<div class="line">║                  ┌─────────┐                                       ┌─────────┐                 ║</div>
<div class="line">║                  │ STATE 1 │                                       │ STATE 2 │                 ║</div>
<div class="line">║       ┌──────────┴─────────┴───────────┐                ┌──────────┴─────────┴──────────┐      ║</div>
<div class="line">║  ┌────┴────┐      ┌────────┐      ┌────┴───┐       ┌────┴────┐      ┌────────┐     ┌────┴───┐  ║</div>
<div class="line">╚═▶│  ENTER  │─────▶│ WITHIN │─────▶│  EXIT  │══════▶│  ENTER  │─────▶│ WITHIN │────▶│  EXIT  │══╣</div>
<div class="line">   └────┬────┘      └────────┘      └────┬───┘       └────┬────┘      └────────┘     └────┬───┘  ║</div>
<div class="line">        │          ┌──────────┐          │                │          ┌──────────┐         │      ║</div>
<div class="line">        └──────────┤TRANSITION├──────────┘                └──────────┤TRANSITION├─────────┘      ║</div>
<div class="line">                   └─────╦────┘                                      └──────────┘                ║</div>
<div class="line">                         ║                  ┌─────────┐                                          ║</div>
<div class="line">                         ║                  │ STATE 3 │                                          ║</div>
<div class="line">                         ║       ┌──────────┴─────────┴───────────┐                              ║</div>
<div class="line">                         ║  ┌────┴────┐      ┌────────┐      ┌────┴───┐                          ║</div>
<div class="line">                         ╚═▶│  ENTER  │─────▶│ WITHIN │─────▶│  EXIT  │══════════════════════════╝</div>
<div class="line">                            └────┬────┘      └────────┘      └────┬───┘</div>
<div class="line">                                 │          ┌──────────┐          │</div>
<div class="line">                                 └──────────┤TRANSITION├──────────┘</div>
<div class="line">                                            └──────────┘</div>
</div><!-- fragment --><p >In addition, it is preferable to use methods to evaluate properties method evaluation occurs during the experiment rather than at first load. <br  />
</p>
<p >For those unfamiliar with object-oriented design, a <em>CLASS</em> (e.g. <code><a class="el" href="classstate_machine.html" title="run a task via a series of states.">stateMachine</a></code>) is created as a variable <em>OBJECT</em> (named <code>sM</code> in this case, it is an <em>instance</em> of the class). ALL Opticka classes are <b>handle classes</b>; this means if we set <code>sM2 = sM</code> — both of these instances point to the same object. Below we list the class name and the object name.</p>
<p >As experiments are run <b>within</b> the <code><a class="el" href="classrun_experiment.html" title="The main experiment manager.">runExperiment</a></code> class <code>runTask()</code> method, this object refers to <em>itself</em> as <code>me</code>, and so methods that belong to <code><a class="el" href="classrun_experiment.html" title="The main experiment manager.">runExperiment</a></code> can be called by using <code>myMethod(me)</code> (or you can also use <code>me.myMethod()</code>, both forms are equivalent). Other object instances are given short names, for example the <code><a class="el" href="classscreen_manager.html" title="screenManager — manage opening and configuring the PTB screen">screenManager</a></code> class is instantiated as <code>s</code>, so to call a method from <a class="el" href="classscreen_manager.html" title="screenManager — manage opening and configuring the PTB screen">screenManager</a> we use <code>myOtherMethod(s)</code>. You will see below the object names that are available as we run the experiment from <code><a class="el" href="classrun_experiment.html" title="The main experiment manager.">runExperiment</a></code>. <br  />
</p>
<p >In some cases <code><a class="el" href="classrun_experiment.html" title="The main experiment manager.">runExperiment</a></code> manages the other classes with similar methods, for example <code>updateTask(me)</code> will manage the call to <code>updateTask(task)</code>, this is often so that <a class="el" href="classrun_experiment.html" title="The main experiment manager.">runExperiment</a> can co-ordinate among the objects and maintain some state in <a class="el" href="classrun_experiment.html" title="The main experiment manager.">runExperiment</a> directly. If this is not required then we just call the methods for each object directly, e.g. <code>drawBackground(s)</code>. <br  />
</p>
<p >We highlight the main classes and methods that are most useful when building a particular paradigm. See the <a class="el" href="_default_state_info_8m.html">DefaultStateInfo.m</a> and other CoreProtocols state info files for examples of their use… <br  />
</p>
<hr  />
<h1><a class="anchor" id="autotoc_md13"></a>
runExperiment ("me" in the state file)</h1>
<ul>
<li>**<code>var = getTaskIndex(me)</code>** <br  />
 It returns the current trial variable number by calling <code>task.outIndex(task.totalRuns)</code>. A trial variable number is unique to a particular task condition (see the <code><a class="el" href="classtask_sequence.html" title="Block-based variable randomisation manager.">taskSequence()</a></code> class which builds these randomised sequences).</li>
<li>**<code>updateFixationTarget(me, useTask, varargin)</code>** / **<code>updateExclusionZones(me, useTask, radius)</code>** <br  />
 To manage several stimuli together, we use the <code><a class="el" href="classmeta_stimulus.html" title="Manager for multiple opticka stimuli.">metaStimulus</a></code> class (<code>stims</code> object name). You can set the <code><a class="el" href="classmeta_stimulus.html#a77f21ac7e8ce5cf4a9029a412f3f994e" title="which stimuli should getFixationPositions() return the positions for?">metaStimulus.fixationChoice</a></code> parameter (one or more stimuli) to specify which stimuli to collect the X and Y positions from to send to the eyetracker. <code>updateFixationTarget(me)</code> (calling <code>getFixationPositions(stims)</code> internally) iterates through each selected stimulus and returns the X and Y positions assigned to <code>me.lastXPosition</code> and <code>me.lastYPosition</code>. Having these values we can now assign them using <code>updateFixationValues(eT)</code>. <code>updateExclusionZones()</code> does the same using <code><a class="el" href="classmeta_stimulus.html#a4e380c4cb6ef93524f9faa2845195c29" title="which stimuli should etExclusionPositions() return the positions for?">metaStimulus.exclusionChoice</a></code> to recover the X and Y positions to set up exclusion zones around specified stimuli.</li>
<li>**<code>needEyeSample(me, value)</code>** <br  />
 On each frame we can check the current eye position (called via <code>getSample(eT)</code>). This method allows us to turn this ON (<code>true</code>) or OFF (<code>false</code>).</li>
<li>**<code>enableFlip(me)</code>** / **<code>disableFlip(me)</code>** <br  />
 Enable or disable the PTB screen flip during the update loop.</li>
<li>**<code>updateConditionalFixationTarget(me, stimulus, variable, value, varargin)</code>** <br  />
 Say you have 4 stimuli each with a different angle changed on every trial by the task object, and want the stimulus matching <code>angle = 90</code> to be used as the fixation target. This method finds which stimulus is set to which particular variable value and assigns the fixation target to the X and Y position of that stimulus.</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md15"></a>
Task Manager ("task" in the state file)</h1>
<ul>
<li>**<code>resetRun(task)</code>** <br  />
 If the subject fails to respond correctly, this method randomises the next trial <b>within</b> the block, minimising the possibility the subject just guesses. If you are at the last trial of a block then this will not do anything.</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md17"></a>
Eyetracker ("eT" in the state file)</h1>
<ul>
<li><p class="startli">**<code>updateFixationValues(eT, X, Y, inittime, fixtime, radius, strict)</code>** <br  />
 This method allows us to update the <code>eT.fixation</code> structure property; we pass in the various parameters that define the fixation window:</p><ul>
<li><code>X</code> = X position in degrees relative to screen centre [0, 0]. <code>+X</code> is to the left.</li>
<li><code>Y</code> = Y position in degrees relative to screen centre [0, 0]. <code>+Y</code> is upwards.</li>
<li><code>inittime</code> = How long the subject is allowed to search before their eye enters the window.</li>
<li><code>fixtime</code> = How long the subject must keep their eyes within the fixation window.</li>
<li><code>radius</code> = if this is a single value, this is the circular radius around <code>X,Y</code>. If it is 2 values it defines the width × height of rectangle around <code>X,Y</code>.</li>
<li><code>strict</code> = if strict is <code>true</code> then do not allow a subject to leave a fixation window once they enter. If <code>false</code> then a subject may enter, leave and re-enter without failure (but must still keep the eye inside the window for the required time).</li>
</ul>
<p class="startli">Note that this command implicitly calls <code>resetFixation(eT)</code> as any previous fixation becomes invalid.</p>
</li>
<li>**<code>resetFixation(eT, removeHistory)</code>** / **<code>resetFixationTime(eT)</code>** / **<code>resetFixationHistory(eT)</code>** / **<code>resetExclusionZone(eT)</code>** / **<code>resetFixInit(eT)</code>** <br  />
 <code>resetFixation</code>: resets all fixation counters that track how long a fixation was held for. Pass <code>removeHistory</code> == true also calls <code>resetFixationHistory(eT)</code> to remove the temporary log of previous eye positions (usually call it only after each trial). <code>resetFixationTime</code>: only reset the fixation window timers. <code>resetExclusionZone</code>: resets (removes) the exclusion zones. <code>resetFixInit</code>: fix init is a timer that stops a saccade away from a position to occur too quickly. This reset removes this check.</li>
<li>**<code>resetOffset(eT)</code>** <br  />
 Reset the drift offset back to <code>X = 0; Y = 0</code> — see <code>driftOffset(eT)</code> for the method that sets this value.</li>
<li>**<code>updateFixationValues(eT,x,y,inittime,fixtime,radius,strict)</code>** / **<code>updateExclusionZones(eT,x,y,radius)</code>** <br  />
 These methods allows you to change any of the parameters of the fixation window[s] or the exclusion zone[s]. The fixation window[s] can be circular or square, the exclusion zone[a] are square.</li>
<li>**<code>getSample(eT)</code>** <br  />
 This simply gets the current X, Y, pupil data from the eyetracker (or if in dummy mode from the mouse position). This is saved in <code>eT.x</code> <code>eT.y</code> <code>eT.pupil</code> and logged to <code>eT.xAll</code> <code>eT.yAll</code> <code>eT.pupilAll</code>. NORMALLY you do not need to call this is it is called by <a class="el" href="classrun_experiment.html" title="The main experiment manager.">runExperiment</a> for you on every frame, depending on whether <code>needEyeSample(me)</code> method was set to <code>true</code> or <code>false</code>.</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md19"></a>
Screen Manager ("s" in the state file)</h1>
<ul>
<li>**<code>drawBackground(s)</code>** <br  />
 Draws the s.backgroundColour to screen.</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md21"></a>
MetaStimulus ("stims" in the state file)</h1>
<p >This class manages groups of stimuli as a single object. Each stimulus can be shown or hidden and <a class="el" href="classmeta_stimulus.html" title="Manager for multiple opticka stimuli.">metaStimulus</a> can also managed masking stimuli if needed.</p>
<ul>
<li>**<code>show(stims, [index])</code>** <br  />
 Show enables a particular stimulus to be drawn to the screen. Without <code>[index]</code> all stimuli are shown. You can specify sets of stimuli, e.g. <code>show(stims, [2 4])</code> to show the second and fourth stimuli.</li>
<li>**<code>hide(stims, [index])</code>** <br  />
 The reverse of <code>show()</code>.</li>
<li>**<code>showSet(stims, n)</code>** <br  />
 <code>stims.stimulusSets</code> is an array of 'sets' of stimuli, for example <code>{3, [1 3], [1 2 3]}</code> and calling e.g. <code>showSet(stims, 3)</code>, would first hide all the stims (<code>hide(stims)</code>), then run <code>show(stims, [1 2 3])</code>. This just makes it a bit easy to manage stimulus sets.</li>
<li>**<code>edit(stims,stimulus,variable,value)</code>** <br  />
 Allows you to modify any parameter of a stimulus during the trial, e.g. &lsquo;edit(stims,3,'sizeOut&rsquo;,2);` sets the size of stimulus 3 to 2°.</li>
<li>**<code>draw(stims)</code>** <br  />
 Calls the <code>draw()</code> method on each of the managed stimuli. Not if you've used <code>show()</code> or <code>hide()</code> or <code>showSet()</code> then some stmuli may not be displayed. This should be called on every frame update, by setting it to run in the <code>withinFcn</code> array.</li>
<li>**<code>animate(stims)</code>** <br  />
 Calls the <code>animate()</code> method for each stimulus, which runs any required per-frame updates (for drifting gratings, moving dots, flashing spots etc.). This should be called after <code>draw()</code> for every frame update within a <code>withinFcn</code> cell array.</li>
<li>**<code>update(stims)</code>** <br  />
 For trial based designs, we may change a variable (like size, or spatial frequency), and <code>update()</code> ensures the stimulus recalculate for this new variable. This is usually run in a correct/incorrect <code>exitFcn</code> block after first calling <code>updateVariables(me)</code>. Note some variables (like phase for gratings) do not require an <code>update()</code> but are applied immediately; however this depends on their implementation in PTB. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Feb 28 2022 01:30:45 for Opticka by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
